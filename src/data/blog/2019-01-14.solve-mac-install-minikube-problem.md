---
title: "è§£å†³ Mac å®‰è£…æœ€æ–°ç‰ˆ minikube å‡ºç°çš„é—®é¢˜"
author: xkcoding
pubDatetime: 2019-01-14T06:22:11.000Z
slug: solve-mac-install-minikube-problem
featured: false
draft: false
tags:
  - kubernetes
  - docker
description: "minikube æ­å»º K8s çœŸçš„å‚»ç“œå¼å—ï¼Ÿè‡³å°‘æˆ‘é‡åˆ°äº†ä¸¤ä¸ªå¤§å‘ï¼škubectl v1.13 å’Œ minikube é»˜è®¤çš„ k8s v1.12 ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œä»¥åŠå›½å†…ç½‘ç»œæ— æ³•æ‹‰å– k8s.gcr.io é•œåƒã€‚æœ¬æ–‡è®°å½•å®Œæ•´çš„æ’å‘è¿‡ç¨‹ï¼š--kubernetes-version æŒ‡å®šç‰ˆæœ¬ã€--docker-env é…ç½®ä»£ç†ï¼ŒVirtualBox NAT æ¨¡å¼ä¸‹ 10.0.2.2 æŒ‡å‘å®¿ä¸»æœºçš„åŸç†ã€‚"
---

kubernetes (æœ¬æ–‡åç»­ç®€ç§° k8s )ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ã€‚Mac æœ¬åœ°è¿è¡Œ k8s æœ€å¿«çš„æ–¹å¼ï¼Œè‚¯å®šæ˜¯åŸºäºå•èŠ‚ç‚¹çš„ minikube æ¥æ­å»ºã€‚äººäººéƒ½è¯´ minikube æ­å»º k8s æœ€ç®€å•ã€å¿«é€Ÿã€åªéœ€è¦å‚»ç“œå¼è¾“å…¥å‘½ä»¤å°±å¯ä»¥æ­å»ºæˆåŠŸï¼Œå¯äº‹å®å¹¶éå¦‚æ­¤ï¼Œæ¯”å¦‚ç¬”è€…åœ¨æ­å»ºçš„è¿‡ç¨‹ä¸­å°±é‡åˆ°äº† **ç‰ˆæœ¬** å’Œ **ä»£ç†** çš„é—®é¢˜ã€‚

ä¸‹é¢æˆ‘å°†å¯¹é‡åˆ°çš„é—®é¢˜ä¸€ä¸€è¿›è¡Œè§£ç­”ã€‚

<!--more-->

## 1. ç¡¬ä»¶ç¯å¢ƒ

- ç³»ç»Ÿï¼š`MacOS Mojave 10.14.2 (18C54)`

## 2. è½¯ä»¶ç¯å¢ƒ

### 2.1. è™šæ‹Ÿæœº

è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ VirtualBoxï¼Œä½¿ç”¨ç‰ˆæœ¬`Virtual Box 5.2.22 r126460 (Qt5.6.3)`ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è™šæ‹Ÿè½¯ä»¶ï¼Œå‚è€ƒï¼šhttps://kubernetes.io/docs/tasks/tools/install-minikube/#install-a-hypervisor

### 2.2. å®‰è£… kubectl

> ç¬”è€…å®‰è£…çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º `v1.13.1`

æœ‰2ç§å®‰è£…æ–¹å¼ï¼š

1. ä½¿ç”¨ `brew` å®‰è£…ï¼Œ`brew install kubernetes-cli`

2. ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼å®‰è£…
   - ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
     `curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.13.1/bin/darwin/amd64/kubectl`
   - ä¿®æ”¹æ–‡ä»¶æƒé™
     `chmod +x ./kubectl`
   - ç§»åŠ¨æ–‡ä»¶åˆ°ç”¨æˆ· bin ç›®å½•
     `sudo mv ./kubectl /usr/local/bin/kubectl`

### 2.3. å®‰è£… minikube

> ç¬”è€…å®‰è£…çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º `v0.32.0`

æœ‰2ç§å®‰è£…æ–¹å¼ï¼š

1. ä½¿ç”¨ `brew` å®‰è£…ï¼Œ`brew cask install minikube`

2. ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼å®‰è£…
   - ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¿®æ”¹æ–‡ä»¶æƒé™
     `curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.32.0/minikube-darwin-amd64 \ && chmod +x minikube`
   - ç§»åŠ¨æ–‡ä»¶åˆ°ç”¨æˆ· bin ç›®å½•
     `sudo cp minikube /usr/local/bin && rm minikube`

## 3. ä½¿ç”¨ minikube å¯åŠ¨ k8s

`minikube start`

## 4. ğŸ’£ å¼‚å¸¸ ğŸ’£

1. minikube é»˜è®¤ä½¿ç”¨çš„ k8s ç‰ˆæœ¬ä¸æœ¬åœ° `kubecli` ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œéƒ¨åˆ†é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼š

   ```bash
   $ minikube start
   Starting local Kubernetes v1.12.4 cluster...
   Starting VM...
   Downloading Minikube ISO
    178.88 MB / 178.88 MB [============================================] 100.00% 0s
   Getting VM IP address...
   E0109 17:30:57.090762   47169 start.go:211] Error parsing version semver:  Version string empty
   Moving files into cluster...
   Downloading kubeadm v1.12.4
   Downloading kubelet v1.12.4
   Finished Downloading kubeadm v1.12.4
   Finished Downloading kubelet v1.12.4
   Setting up certs...
   Connecting to cluster...
   Setting up kubeconfig...
   Stopping extra container runtimes...
   Starting cluster components...
   E0109 17:38:49.423563   47169 start.go:343] Error starting cluster:  kubeadm init error
   sudo /usr/bin/kubeadm init --config /var/lib/kubeadm.yaml --ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests --ignore-preflight-errors=DirAvailable--data-minikube --ignore-preflight-errors=Port-10250 --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-scheduler.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-apiserver.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-kube-controller-manager.yaml --ignore-preflight-errors=FileAvailable--etc-kubernetes-manifests-etcd.yaml --ignore-preflight-errors=Swap --ignore-preflight-errors=CRI
    running command: : Process exited with status 2
   ================================================================================
   An error has occurred. Would you like to opt in to sending anonymized crash
   information to minikube to help prevent future errors?
   To opt out of these messages, run the command:
   	minikube config set WantReportErrorPrompt false
   ================================================================================
   Please enter your response [Y/n]: %
   ```

   **è§£å†³ï¼š**
   https://github.com/kubernetes/minikube/issues/3517#issuecomment-453035044
   å› ä¸º minikube é»˜è®¤ä½¿ç”¨çš„ v1.12.x ç‰ˆæœ¬çš„ k8sï¼Œä½†æ˜¯æˆ‘ä»¬å®‰è£…çš„ kubectl ç‰ˆæœ¬ä¸º v1.13.1ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£å†³ï¼Œ`minikube start --alsologtostderr --kubernetes-version v1.13.1`

2. ä»£ç†é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¼Ÿå¤§çš„ç¥–å›½ç¹è£å¯Œå¼ºï¼Œå¯¼è‡´æ— æ³•ä¸‹è½½k8sé•œåƒï¼Œéƒ¨åˆ†é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼š

   ```bash
   I0114 10:47:38.727892    4695 utils.go:224] ! error execution phase preflight: [preflight] Some fatal errors occurred:
   I0114 10:47:38.727931    4695 utils.go:224] ! 	[ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-apiserver:v1.13.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: proxyconnect tcp: dial tcp :80: connect: connection refused
   I0114 10:47:38.727941    4695 utils.go:224] ! , error: exit status 1
   I0114 10:47:38.727963    4695 utils.go:224] ! 	[ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-controller-manager:v1.13.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: proxyconnect tcp: dial tcp :80: connect: connection refused
   I0114 10:47:38.727975    4695 utils.go:224] ! , error: exit status 1
   ```

   **è§£å†³ï¼š**
   https://github.com/kubernetes/minikube/issues/3517#issuecomment-453906287
   åœ¨å¯åŠ¨ minikube çš„æ—¶å€™åŠ ä¸Šä»£(fan)ç†(qiang)åœ°å€ï¼Œä½¿ç”¨ `--docker-env` å‚æ•°æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š
   `minikube start --alsologtostderr --kubernetes-version v1.13.1 --docker-env HTTP_PROXY=http://10.0.2.2:1087 --docker-env HTTPS_PROXY=http://10.0.2.2:1087 --docker-env NO_PROXY=10.0.2.2,$(minikube ip)`
   **å‚æ•°è§£æï¼š**
   `10.0.2.2` è¿™ä¸ªipå…¶å®æ˜¯å› ä¸º virtual box é‡Œè™šæ‹Ÿæœºå¦‚æœä½¿ç”¨NATæ¨¡å¼çš„ç½‘å¡çš„æ—¶å€™ `10.0.2.2 `é»˜è®¤æŒ‡å‘çš„æ˜¯å®¿ä¸»æœºçš„ `127.0.0.1`ï¼Œå‚è€ƒåœ°å€ï¼šhttps://forums.docker.com/t/beginner-having-trouble-with-docker-behind-company-proxy/3968

## 5. å¯åŠ¨

1. éƒ¨åˆ†å¯åŠ¨æˆåŠŸæ—¥å¿—ä¿¡æ¯ï¼š

   ```bash
   .....
   I0114 13:35:19.102229    7316 utils.go:224] > Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
   I0114 13:35:19.102246    7316 utils.go:224] >   https://kubernetes.io/docs/concepts/cluster-administration/addons/
   I0114 13:35:19.102260    7316 utils.go:224] > You can now join any number of machines by running the following on each node
   I0114 13:35:19.102287    7316 utils.go:224] > as root:
   I0114 13:35:19.102307    7316 utils.go:224] >   kubeadm join localhost:8443 --token agf5vb.45h4fw6jqy7o2yff --discovery-token-ca-cert-hash sha256:c60ce3456d2ac3225edc119d1792d1b6c20b40b03cf0812ddf8d2fc867f21bf3
   Verifying kubelet health ...I0114 13:35:19.134467    7316 ssh_runner.go:137] Run with output: sudo systemctl is-active kubelet
   I0114 13:35:19.141912    7316 utils.go:224] > active

   Verifying apiserver health ...I0114 13:35:19.149990    7316 kubeadm.go:99] https://192.168.99.101:8443/healthz response: <nil> &{Status:200 OK StatusCode:200 Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map[Date:[Mon, 14 Jan 2019 05:35:19 GMT] Content-Length:[2] Content-Type:[text/plain; charset=utf-8]] Body:0xc0004b9d00 ContentLength:2 TransferEncoding:[] Close:false Uncompressed:false Trailer:map[] Request:0xc0002da500 TLS:0xc000354000}
   Kubectl is now configured to use the cluster.
   Loading cached images from config file.


   Everything looks great. Please enjoy minikube!
   ```

2. `minikube dashboard` ä¹‹åï¼Œå¯åŠ¨ dashboad æˆªå›¾ï¼š

   ![dashboard](http://static.xkcoding.com/blog/solve-mac-install-minikube-problem/image-minikube-dashboard.png)
