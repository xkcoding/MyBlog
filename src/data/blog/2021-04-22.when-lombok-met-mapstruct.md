---
title: "å½“ Lombok é‡è§äº† MapStruct ã®ã€Œå‘ã€"
author: xkcoding
pubDatetime: 2021-04-22T06:01:21.000Z
slug: when-lombok-met-mapstruct
featured: true
draft: false
tags:
  - java
description: "Lombok å’Œ MapStruct éƒ½å¾ˆé¦™ï¼Œä½†ä¸€èµ·ç”¨å°±ç¿»è½¦ï¼Ÿç¼–è¯‘æŠ¥é”™ã€Œæ‰¾ä¸åˆ° getXXX() æ–¹æ³•ã€ï¼Ÿåˆ«æ€¥ï¼Œè¿™æ˜¯ Annotation Processor æ‰§è¡Œé¡ºåºçš„é”…ã€‚ä¸¤è€…éƒ½åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç ï¼Œä½† Maven ä¸çŸ¥é“è¦å…ˆè·‘ Lombok å†è·‘ MapStructã€‚æœ¬æ–‡å¸¦ä½ ç†è§£é—®é¢˜æœ¬è´¨ï¼Œåªéœ€åœ¨ pom.xml çš„ annotationProcessorPaths é‡ŒåŠ ä¸€è¡Œé…ç½®ï¼Œè®© Lombok æ’åœ¨ MapStruct å‰é¢ï¼Œé—®é¢˜è¿åˆƒè€Œè§£ã€‚é™„å®Œæ•´å¯è¿è¡Œç¤ºä¾‹ä»£ç ã€‚"
---

## å‰è¨€

2021 å¹´äº†ï¼Œç›¸ä¿¡æ Java çš„å°ä¼™ä¼´ä»¬ä¸ä¼šè¿˜æ²¡æœ‰äººæ²¡ç”¨è¿‡ Lombok å§ï¼Ÿ

Lombok æ˜¯ä¸€æ¬¾é€šè¿‡ã€Œ`æ³¨è§£`ã€çš„å½¢å¼ç®€åŒ–å¹¶æ¶ˆé™¤å†—ä½™ä»£ç çš„ Java æ’ä»¶ï¼Œåˆ©ç”¨ã€Œ`Annotation Processor`ã€åŸç†ï¼Œåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä¸€äº›ã€Œé‡å¤ã€ä»£ç ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ IDEA ç¯å¢ƒä¸‹ï¼Œéœ€è¦é¢å¤–å®‰è£…ä¸€ä¸ª Lombok æ’ä»¶ã€‚ï¼ˆæœ¬æ–‡ä¸ä¼šä¸“é—¨ä»‹ç» Lombok çš„ä½¿ç”¨æ–¹æ³•ï¼Œæƒ³è¦æ·±å…¥å­¦ä¹ çš„å°ä¼™ä¼´å¯ä»¥å» [å®˜æ–¹æ–‡æ¡£](https://projectlombok.org/features/all) å­¦ä¹  Lombok æä¾›çš„æ‰€æœ‰æ³¨è§£çš„ä½¿ç”¨æ–¹æ³•ã€‚ï¼‰

å¯èƒ½ä¸€äº›æœ‹å‹å¯¹ MapStruct å°±æœ‰ç‚¹é™Œç”Ÿäº†ï¼Œä½†æ˜¯æˆ‘æ•¢è‚¯å®šçš„æ˜¯ï¼Œä½ ä»¬ä¸€å®šç”¨è¿‡å’Œä»–åŠŸèƒ½ç±»ä¼¼çš„å·¥å…·ã€‚æ¯”å¦‚ Apache Commons BeanUtilsã€Spring BeanUtilsã€BeanCopierã€Dozer ç­‰ç­‰ã€‚æ²¡é”™ï¼ŒMapStruct ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å¯¹è±¡å±æ€§æ‹·è´è¿™ä¸€ä¸ªé€šç”¨éœ€æ±‚çš„ã€‚ä¼ ç»Ÿä½¿ç”¨ã€Œ`åå°„`ã€è¿›è¡Œå±æ€§æ‹·è´çš„æ–¹å¼ï¼Œåœ¨å¤§æ•°æ®é‡çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½ä½ä¸‹ï¼Œæ•ˆç‡å ªå¿§ã€‚MapStruct åº•å±‚åˆ™æ˜¯é€šè¿‡ `getter/setter` çš„æ–¹å¼æå‡å±æ€§æ‹·è´çš„æ€§èƒ½çš„ï¼Œè·Ÿ Lombok ä¸€æ ·åˆ©ç”¨ã€Œ`Annotation Processor`ã€çš„åŸç†ï¼Œåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ã€‚

<!--more-->

## è¸©å‘

é¦–å…ˆæˆ‘ä»¬æŒ‰ç…§ MapStruct å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼Œæ­ä¸€ä¸ªç®€å•çš„æ —å­ğŸŒ°~

å¼•å…¥ä¾èµ–ï¼š

```xml
<properties>
    <mapstruct.version>1.4.2.Final</mapstruct.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.mapstruct</groupId>
        <artifactId>mapstruct</artifactId>
        <version>${mapstruct.version}</version>
    </dependency>
</dependencies>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.1</version>
            <configuration>
                <source>1.8</source>
                <target>1.8</target>
                <annotationProcessorPaths>
                    <!-- MapStruct åœ¨ç¼–è¯‘æ—¶ä¼šé€šè¿‡è¿™ä¸ªæ’ä»¶ç”Ÿæˆä»£ç  -->
                    <path>
                        <groupId>org.mapstruct</groupId>
                        <artifactId>mapstruct-processor</artifactId>
                        <version>${mapstruct.version}</version>
                    </path>
                </annotationProcessorPaths>
            </configuration>
        </plugin>
    </plugins>
</build>
```

åˆ›å»ºä¸¤ä¸ªç±»ï¼Œç”¨äºå±æ€§æ‹·è´ã€‚

```java
// æºå¯¹è±¡
public class CarDO {
    private String make;
    private int numberOfSeats;
    private CarType type;

    public CarDO() {
    }

    public CarDO(String make, int numberOfSeats, CarType type) {
        this.make = make;
        this.numberOfSeats = numberOfSeats;
        this.type = type;
    }

    public String getMake() {
        return make;
    }

    public void setMake(String make) {
        this.make = make;
    }

    public int getNumberOfSeats() {
        return numberOfSeats;
    }

    public void setNumberOfSeats(int numberOfSeats) {
        this.numberOfSeats = numberOfSeats;
    }

    public CarType getType() {
        return type;
    }

    public void setType(CarType type) {
        this.type = type;
    }
}

// æµ‹è¯•æšä¸¾
public enum CarType {
    /**
     * æ™®é€š
     */
    COMMON,
    /**
     * è€çˆ·è½¦
     */
    OLD,
    /**
     * è·‘è½¦
     */
    SPORTS;
}

// ç›®æ ‡å¯¹è±¡
public class CarDTO {
    private String make;
    private int seatCount;
    private String type;

    public CarDTO() {
    }

    public CarDTO(String make, int seatCount, String type) {
        this.make = make;
        this.seatCount = seatCount;
        this.type = type;
    }

    public String getMake() {
        return make;
    }

    public void setMake(String make) {
        this.make = make;
    }

    public int getSeatCount() {
        return seatCount;
    }

    public void setSeatCount(int seatCount) {
        this.seatCount = seatCount;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }
}
```

åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ‹·è´æ¥å£ï¼Œç”¨äºå‘Šè¯‰ MapStruct éœ€è¦ç”Ÿæˆå“ªä¸ªå¯¹è±¡çš„å±æ€§æ‹·è´ã€‚

> æ³¨æ„ï¼šè¿™é‡Œ `@Mapper / Mappers / @Mapping` éƒ½æ˜¯ `org.mapstruct` åŒ…ä¸‹çš„ï¼Œå½“å’Œ Mybatis ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¸è¦å¼•ç”¨é”™äº†~

```java
@Mapper
public interface CarMapper {
    CarMapper INSTANCE = Mappers.getMapper(CarMapper.class);

    @Mapping(source = "numberOfSeats", target = "seatCount")
    CarDTO carToCarDto(CarDO car);
}
```

æœ€ååˆ›å»ºæµ‹è¯•ç±»ï¼Œæµ‹è¯•ä¸€æŠŠï¼

```java
public class TestMapStruct {
    @Test
    public void shouldMapCarToDto() {
        //given
        CarDO car = new CarDO("Morris", 5, CarType.SPORTS);

        //when
        CarDTO carDto = CarMapper.INSTANCE.carToCarDto(car);

        //then
        Assert.assertNotNull(carDto);
        Assert.assertEquals("Morris", carDto.getMake());
        Assert.assertEquals(5, carDto.getSeatCount());
        Assert.assertEquals("SPORTS", carDto.getType());
    }
}
```

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„åšæ³•ï¼Œååˆ†é¡ºåˆ©ï¼Œæµ‹è¯•é€šè¿‡ï¼

å¦‚æœæˆ‘ä»¬æŠŠ 2 ä¸ªå®ä½“ç±»é‡Œçš„ `getter/setter` æ›¿æ¢æˆ Lombokï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆæ”¹é€  `pom.xml` æ–‡ä»¶ï¼Œå¢åŠ  Lombok ç›¸å…³ä¾èµ–ï¼š

```diff
<properties>
+    <lombok.version>1.18.12</lombok.version>
    <mapstruct.version>1.4.2.Final</mapstruct.version>
</properties>

<dependencies>
+    <dependency>
+        <groupId>org.projectlombok</groupId>
+        <artifactId>lombok</artifactId>
+        <version>${lombok.version}</version>
+    </dependency>
    <dependency>
        <groupId>org.mapstruct</groupId>
        <artifactId>mapstruct</artifactId>
        <version>${mapstruct.version}</version>
    </dependency>
</dependencies>
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å®ä½“ç±»ä»£ç åº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š

```java
// æºå¯¹è±¡
@Data
@NoArgsConstructor
@AllArgsConstructor
public class CarDO {
    private String make;
    private int numberOfSeats;
    private CarType type;
}

// ç›®æ ‡å¯¹è±¡
@Data
@NoArgsConstructor
@AllArgsConstructor
public class CarDTO {
    private String make;
    private int seatCount;
    private String type;
}
```

å†æ¥æ‰§è¡Œä¸€éæµ‹è¯•ç±»ï¼Œç¼–è¯‘æ—¶å°±ä¼šå‡ºç°ç±»ä¼¼è¿™ç§ã€Œ`java: æ‰¾ä¸åˆ°ç¬¦å· ç¬¦å·: æ–¹æ³• getXXX()`ã€é”™è¯¯æç¤ºï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š

![å¼‚å¸¸](https://static.xkcoding.com/blog/when-lombok-met-mapstruct/%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF.png)

å½“å‡ºç°è¿™ç§é”™è¯¯ï¼Œåˆ†æ˜å°±æ˜¯ Lombok æ²¡æœ‰ç”Ÿæ•ˆå˜›ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

## è§£å‘

è¿˜è®°å¾—æ–‡ç« å¼€å¤´ä»‹ç»çš„ï¼ŒLombok å’Œ MapStruct éƒ½æ˜¯åˆ©ç”¨ã€Œ`Annotation Processor`ã€åœ¨ç¨‹åºç¼–è¯‘æ—¶ç”Ÿæˆä»£ç çš„å—ï¼Ÿ

**äº†è§£åŸç†ï¼Œé—®é¢˜å°±å®¹æ˜“è§£å†³äº†ã€‚**

å‰æ–‡æˆ‘ä»¬åœ¨æµ‹è¯• MapStruct çš„æ—¶å€™ï¼Œåœ¨ `pom.xml` æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªä¸€ä¸ªæ’ä»¶ï¼Œç”¨äºå‘Šè¯‰ Maven ç¼–è¯‘æ—¶ï¼Œéœ€è¦é¢å¤–æ‰§è¡Œ MapStruct çš„ä»£ç ç”Ÿæˆé€»è¾‘ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å‘Šè¯‰ Maven åœ¨ç¼–è¯‘æ—¶ï¼ŒLombok ä¹Ÿéœ€è¦ç”Ÿæˆä»£ç ã€‚

æˆ‘ä»¬åœ¨ `pom.xml` æ–‡ä»¶çš„ `build` èŠ‚ç‚¹ä¸­åŠ ä¸Šè¿™ä¹ˆä¸€æ®µï¼š

```diff
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.1</version>
            <configuration>
                <source>1.8</source>
                <target>1.8</target>
                <annotationProcessorPaths>
                    <!-- Lombok åœ¨ç¼–è¯‘æ—¶ä¼šé€šè¿‡è¿™ä¸ªæ’ä»¶ç”Ÿæˆä»£ç  -->
+                    <path>
+                        <groupId>org.projectlombok</groupId>
+                        <artifactId>lombok</artifactId>
+                        <version>${lombok.version}</version>
+                    </path>
                    <!-- MapStruct åœ¨ç¼–è¯‘æ—¶ä¼šé€šè¿‡è¿™ä¸ªæ’ä»¶ç”Ÿæˆä»£ç  -->
                    <path>
                        <groupId>org.mapstruct</groupId>
                        <artifactId>mapstruct-processor</artifactId>
                        <version>${mapstruct.version}</version>
                    </path>
                </annotationProcessorPaths>
            </configuration>
        </plugin>
    </plugins>
</build>
```

è¿™ä¸ªæ—¶å€™ï¼Œå†å»è¿è¡Œä¸€ä¸‹é€šè¿‡æµ‹è¯•ç±»ï¼Œå°±ä¸ä¼šå‡ºç°ä¸Šè¿°æ‰¾ä¸åˆ° get æ–¹æ³•çš„é”™è¯¯äº†~

---

é…å¥—ä»£ç ï¼šhttps://github.com/xkcoding/practice_demo/tree/master/lombok-with-mapstruct
