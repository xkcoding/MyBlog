---
title: "DevOps ä¹‹ Jenkins å®‰è£…ã€é…ç½®ã€ç¾åŒ–ã€æ’ä»¶åŠå¸¸è§é”™è¯¯å¤„ç†"
author: xkcoding
pubDatetime: 2018-01-04T05:19:13.000Z
slug: devops-jenkins
featured: false
draft: false
tags:
  - jenkins
  - devops
  - ci
description: ""
---
ç»§ç»­ä¸Šä¸€ç¯‡çš„è¯é¢˜ï¼Œæ—¢ç„¶å·²ç»æ­å»ºäº† GitLab çš„ä»£ç ä»“åº“ï¼Œé‚£ä¹ˆç°åœ¨å°±å¯ä»¥å¼€å§‹è¿›è¡Œä¸‹ä¸€æ­¥æŒç»­é›†æˆç¯å¢ƒçš„æ­å»ºäº†ã€‚å…¬å¸å‡†å¤‡åˆ©ç”¨ Jenkins CI è¿›è¡ŒæŒç»­é›†æˆï¼Œæœ¬æ–‡è®°å½•äº†  Jenkins çš„å®‰è£…ã€åŸºç¡€é…ç½®ã€ç•Œé¢ç¾åŒ–ã€å¸¸ç”¨æ’ä»¶åŠå¸¸è§é”™è¯¯å¤„ç†ã€‚

<!--more-->

## 1. å®‰è£…Jenkins

**å‡†å¤‡å·¥ä½œ**

1. å®‰è£… JDKï¼Œå¹¶é…ç½®ç¯å¢ƒå˜é‡

2. å®‰è£… maven

3. é…ç½®é˜¿é‡Œäº‘çš„ maven é•œåƒæºåœ°å€ï¼Œ`vim /usr/share/maven/conf/settings.xml` å°†ğŸ‘‡å†…å®¹æ·»åŠ è¿› `mirrors` èŠ‚ç‚¹

   ```xml
   <mirror>
       <!--This sends everything else to /public -->
       <id>nexus-aliyun</id>
       <mirrorOf>*</mirrorOf>
       <name>Nexus aliyun</name>
       <url>http://maven.aliyun.com/nexus/content/groups/public</url>
   </mirror>
   ```

4. å®‰è£… git

**é…ç½®é•œåƒæºåœ°å€**

```shell
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
yum install jenkins
```

**ä¿®æ”¹è®¿é—® IP å’Œ ç«¯å£å·**

1. `vim /etc/sysconfig/jenkins`
2. `JENKINS_PORT="10080"`

**é…ç½® JDK è·¯å¾„åˆ° Jenkins ä¸­**

1. `vim /etc/init.d/jenkins`

2. å°†è‡ªå·±çš„ java ç›®å½•åŠ å…¥åˆ° `candidates` é‡Œ

   ```properties
   candidates="
   /etc/alternatives/java
   /usr/lib/jvm/java-1.8.0/bin/java
   /usr/lib/jvm/jre-1.8.0/bin/java
   /usr/lib/jvm/java-1.7.0/bin/java
   /usr/lib/jvm/jre-1.7.0/bin/java
   /usr/bin/java
   /opt/jdk1.8.0_144/bin/java
   "
   ```

**å®‰è£…å®Œæ¯•åå¯åŠ¨**

```shell
sudo service jenkins start # å¯åŠ¨jenkinsæœåŠ¡ 
```

## 2. é…ç½® Jenkins

1. **åˆå§‹åŒ–å¯†ç **

   `cat /var/lib/jenkins/secrets/initialAdminPassword`

2. **å®‰è£…æ’ä»¶**

   é€‰æ‹©å·¦ä¾§æ¨èçš„æ’ä»¶å®‰è£…å³å¯

3. **é…ç½®ç®¡ç†å‘˜è´¦å·å¯†ç **

4. **é…ç½® JDKã€Mavenã€Gitã€Docker**

   ç³»ç»Ÿç®¡ç† â†’ å…¨å±€å·¥å…·é…ç½®ï¼ˆå°½é‡åœ¨æœåŠ¡å™¨æœ¬åœ°å®‰è£…ï¼Œç„¶åè¾“å…¥å®‰è£…è·¯å¾„ï¼Œä¸æ¨èä½¿ç”¨åœ¨çº¿å®‰è£…ï¼Œå› ä¸ºåœ¨çº¿å®‰è£…æœ‰äº›èµ„æºéƒ½åœ¨å›½å¤–ï¼Œä¸‹è½½é€Ÿåº¦ææ…¢ï¼‰

5. **é…ç½®é‚®ä»¶æœåŠ¡å™¨ä¿¡æ¯**

   ç³»ç»Ÿç®¡ç† â†’ ç³»ç»Ÿè®¾ç½®ï¼Œâ‘ Jenkins Locationâ†’ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€â‘¡Extended E-mail Notificationâ‘¢é‚®ä»¶é€šçŸ¥ã€‚

   å…¶ä¸­**Extended E-mail Notification**çš„ä¸¤ä¸ªåœ°æ–¹å¯ä»¥åšä¸ªæ€§åŒ–é…ç½®ï¼š

   - Default Content Type é‚®ä»¶çš„å†…å®¹ç±»å‹ï¼Œæ”¹ä¸º`HTML(text/html)`ã€‚

   - Default Subject é‚®ä»¶çš„æ ‡é¢˜ï¼Œæ”¹ä¸º`æ„å»ºé€šçŸ¥ï¼š$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!`ã€‚

   - Default Content é‚®ä»¶çš„å†…å®¹ï¼Œæ”¹ä¸ºğŸ‘‡å†…å®¹ã€‚

     ```html
     <!DOCTYPE html>
     <html>
     <head>
     <meta charset="UTF-8">
     <title>${PROJECT_NAME}-ç¬¬${BUILD_NUMBER}æ¬¡æ„å»ºæ—¥å¿—</title>
     </head>

     <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">
         <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif">
             <tr>
                 <td>(æœ¬é‚®ä»¶æ˜¯ç¨‹åºè‡ªåŠ¨ä¸‹å‘çš„ï¼Œè¯·å‹¿å›å¤ï¼)</td>
             </tr>
             <tr>
                 <td><h2>
                         <font color="#0000FF">æ„å»ºç»“æœ - ${BUILD_STATUS}</font>
                     </h2></td>
             </tr>
             <tr>
                 <td><br />
                 <b><font color="#0B610B">æ„å»ºä¿¡æ¯</font></b>
                 <hr size="2" width="100%" align="center" /></td>
             </tr>
             <tr>
                 <td>
                     <ul>
                         <li>é¡¹ç›®åç§°ï¼š ${PROJECT_NAME}</li>
                         <li>æ„å»ºç¼–å·ï¼š ç¬¬${BUILD_NUMBER}æ¬¡æ„å»º</li>
                         <li>è§¦å‘åŸå› ï¼š ${CAUSE}</li>
                         <li>æ„å»ºæ—¥å¿—ï¼š <a href="${BUILD_URL}console">${BUILD_URL}console</a></li>
                         <li>æ„å»ºUrlï¼š <a href="${BUILD_URL}">${BUILD_URL}</a></li>
                         <li>å·¥ä½œç›®å½•ï¼š <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a></li>
                         <li>é¡¹ç›®Urlï¼š <a href="${PROJECT_URL}">${PROJECT_URL}</a></li>
                     </ul>
                 </td>
             </tr>
             <tr>
                 <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>
                 <hr size="2" width="100%" align="center" /></td>
             </tr>
             <tr>
                 <td>
                     <ul>
                         <li>å†å²å˜æ›´è®°å½• : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>
                     </ul> ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br />%c<br />",showPaths=true,changesFormat="<pre>[%a]<br />%m</pre>",pathFormat="    %p"}  
                 </td>
             </tr>
             <tr>
                 <td><b>Test Informations</b>
                 <hr size="2" width="100%" align="center" /></td>
             </tr>
             <tr>
                 <td><pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif">Total:${TEST_COUNTS,var="total"},Pass:${TEST_COUNTS,var="pass"},Failed:${TEST_COUNTS,var="fail"},Skiped:${TEST_COUNTS,var="skip"}</pre>
                     <br /></td>
             </tr>
             <tr>
                 <td><b><font color="#0B610B">æ„å»ºæ—¥å¿— (æœ€å 100è¡Œ):</font></b>
                 <hr size="2" width="100%" align="center" /></td>
             </tr>
             <tr>
                 <td><textarea cols="80" rows="30" readonly="readonly" style="font-family: Courier New">${BUILD_LOG, maxLines=100}</textarea>
                 </td>
             </tr>
         </table>
     </body>
     </html>
     ```

   - å‹¾é€‰ä¸Š **Enable Debug Modeã€Require Administrator for Template Testingã€Enable watching for jobsã€Allow sending to unregistered users**

## 3. ç¾åŒ– Jenkins

å®‰åˆ©ä¸€æ¬¾materialé£æ ¼çš„ä¸»é¢˜ï¼šhttp://afonsof.com/jenkins-material-theme/ ï¼Œæ”¯æŒä½¿ç”¨ CDNï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰å…¬å¸ logo ç­‰ç­‰ã€‚

## 4. å¸¸ç”¨æ’ä»¶

1. Maven Integration pluginï¼šç”¨äºæ„å»º Maven é¡¹ç›®
2. Gitlab Hook Pluginï¼šç”¨äºè§¦å‘ GitLab çš„ä¸€äº› WebHooks æ¥æ„å»ºé¡¹ç›®
3. Simple Theme Pluginï¼šé…åˆä¸Šé¢çš„ç¾åŒ– Jenkins ä½¿ç”¨
4. FireLine Pluginï¼šä»£ç è§„èŒƒæ£€æŸ¥ï¼Œå·²ç»é›†æˆäº†é˜¿é‡Œå·´å·´çš„ä»£ç è§„çº¦ï¼ˆP3Cï¼‰æ£€æŸ¥
5. HTML Publisher pluginï¼šå°†ä¸€äº›æµ‹è¯•ç»“æœå˜æˆ HTML æ–‡æ¡£
6. JUnit Pluginï¼šJUnit æµ‹è¯•
7. [Checkstyle Plug-in](https://plugins.jenkins.io/checkstyle)ï¼šæ£€æµ‹ä»£ç é£æ ¼
8. [FindBugs Plug-in](https://plugins.jenkins.io/findbugs)ï¼šæ£€æµ‹æ„å»ºå‡ºæ¥çš„ class æ–‡ä»¶æ˜¯å¦å®‰å…¨
9. [Static Analysis Collector Plug-in](https://plugins.jenkins.io/analysis-collector)ï¼šå¯¹7ã€8ä¸¤ä¸ªæ’ä»¶æ£€æµ‹å‡ºæ¥çš„ç»“æœè¿›è¡Œæ±‡æ€»
10. Extended E-mail Notificationï¼šä¸ªæ€§åŒ–é‚®ä»¶æ¨¡æ¿
11.  [Dingding[é’‰é’‰] Plugin](https://wiki.jenkins.io/display/JENKINS/Dingding+Notification+Plugin)ï¼šé’‰é’‰é€šçŸ¥æ’ä»¶

## 5. å¸¸è§é”™è¯¯è§£å†³

**æ·»åŠ é•œåƒæºçš„æ—¶å€™å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š**

```shell
Resolving pkg.jenkins-ci.org (pkg.jenkins-ci.org)... failed: Temporary failure in name resolution.

wget: unable to resolve host address â€˜pkg.jenkins-ci.orgâ€™
```

è§£å†³æ–¹æ³•ï¼š

`vim  /etc/resolv.conf` æ·»åŠ ä¸€è¡Œ `nameserver 8.8.8.8`

**HTML Publisher Plugin æ’ä»¶åœ¨æ–°çš„Jenkinsç‰ˆæœ¬ä¸­ï¼Œæ‰“å¼€ç”Ÿæˆçš„ç½‘é¡µä¸­æ— æ³•åŠ è½½CSSã€æ— æ³•ç‚¹å‡»æŒ‰é’®ç­‰æƒ…å†µï¼š**

ç”±äº CSPï¼ˆContent Security Policyï¼‰æ‰€è‡´ï¼Œå¯åœ¨ ç³»ç»Ÿç®¡ç†â†’è„šæœ¬å‘½ä»¤è¡Œ ä¸­æ‰§è¡Œï¼š

 `System.setProperty("hudson.model.DirectoryBrowserSupport.CSP","")`