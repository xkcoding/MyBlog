---
title: "è§£å†³ MacOS BigSur ä½¿ç”¨ pip å®‰è£…ä¾èµ–å¤±è´¥çš„é—®é¢˜"
author: xkcoding
pubDatetime: 2021-03-10T11:23:16.000Z
slug: fix-error-about-python-package-install-on-big-sur
featured: false
draft: false
tags:
  - python
description: "è¢«åŸºé‡‘ä¼¤é€äº†å¿ƒï¼Œæƒ³å­¦é‡åŒ–äº¤æ˜“ï¼Ÿå®‰è£…èšå®½æ•°æ® SDK å´æŠ¥é”™ `clang: error: invalid version number in 'MACOSX_DEPLOYMENT_TARGET=11'`ï¼Ÿè¿™æ˜¯ macOS Big Sur çš„å‘ï¼Command Line Tools ç‰ˆæœ¬å¤ªæ—§ä¸æ”¯æŒ macOS 11ã€‚è§£å†³æ–¹æ³•ï¼šç”¨ `brew doctor` æ£€æµ‹é—®é¢˜ï¼Œé‡è£… CLT å‡çº§ clang åˆ° 12.0ã€‚é™„å®Œæ•´æ’æŸ¥æ€è·¯ + è§£å†³æ­¥éª¤ã€‚"
---

## å‰è¨€

å¹´ååˆ°ç°åœ¨ï¼Œæˆ‘å·²ç»è¢«åŸºé‡‘ä¼¤é€äº†å¿ƒğŸ¤•

äºæ˜¯ä¹ï¼Œä¸ºäº†äº‰å–ä¸åš `éŸ­é›¶å`ï¼Œæˆ‘æ‰“ç®—å­¦ä¹ ä¸€ä¸‹å…³äºé‡åŒ–äº¤æ˜“æ–¹é¢çš„å†…å®¹ã€‚

å­¦ä¹ é‡åŒ–äº¤æ˜“ï¼Œé¦–å…ˆå¾—å…ˆæ‹¿åˆ°äº¤æ˜“çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ [èšå®½æ•°æ®](https://www.joinquant.com/help/api/help#JQData:%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8JQData) æä¾›çš„æœ¬åœ°æ•°æ®æ¥å£ï¼Œå®˜æ–¹æä¾›äº† Python SDKï¼Œæ‰€ä»¥æˆ‘å°±å¼€å§‹ç…§ç€æ–‡æ¡£å®‰è£… SDK â€¦â€¦

<!--more-->

ç…§ç€æ–‡æ¡£çš„å®‰è£…æ­¥éª¤ï¼Œå…¶å®å¾ˆç®€å•ï¼š

```shell
$ pip install jqdatasdk
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥å…³æ‰æœ¬æ–‡äº†ã€‚

å¯å¦‚æœä½ çš„ç¯å¢ƒå’Œæˆ‘ä¸€æ ·ï¼š

- ç³»ç»Ÿç‰ˆæœ¬ï¼š`MacOS BigSur 11.2.3`
- Python ç‰ˆæœ¬ï¼š`3.9`
- IDE ç‰ˆæœ¬ï¼š`PyCharm Professional 2020.3`

é‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ä¼šå®‰è£…å¤±è´¥ï¼Œå¹¶ä¸”é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼ˆæˆªå–éƒ¨åˆ†æ—¥å¿—ï¼‰ï¼š

```shell
$ pip install jqdatasdk
Collecting jqdatasdk
  Using cached jqdatasdk-1.8.8-py3-none-any.whl (151 kB)
Requirement already satisfied: six in /usr/local/lib/python3.9/site-packages (from jqdatasdk) (1.15.0)
......(çœç•¥éƒ¨åˆ†æ—¥å¿—)
Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.9/site-packages (from requests->jqdatasdk) (1.26.3)
Building wheels for collected packages: thriftpy2
  Building wheel for thriftpy2 (setup.py) ... error
  ERROR: Command errored out with exit status 1:
   command: /usr/local/opt/python@3.9/bin/python3.9 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/private/var/folders/tx/_rv7b39127d289cpmm3dpylr0000gn/T/pip-install-p9oxcpjv/thriftpy2_42f75cad7b3842908525f1c376f2eb3d/setup.py'"'"'; __file__='"'"'/private/var/folders/tx/_rv7b39127d289cpmm3dpylr0000gn/T/pip-install-p9oxcpjv/thriftpy2_42f75cad7b3842908525f1c376f2eb3d/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /private/var/folders/tx/_rv7b39127d289cpmm3dpylr0000gn/T/pip-wheel-vdjkejow
       cwd: /private/var/folders/tx/_rv7b39127d289cpmm3dpylr0000gn/T/pip-install-p9oxcpjv/thriftpy2_42f75cad7b3842908525f1c376f2eb3d/
  Complete output (93 lines):
  running bdist_wheel
  The [wheel] section is deprecated. Use [bdist_wheel] instead.
......(çœç•¥éƒ¨åˆ†æ—¥å¿—)
  creating build/temp.macosx-11-x86_64-3.9/thriftpy2/transport
  clang -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/usr/local/opt/tcl-tk/include -I/usr/local/Cellar/python@3.9/3.9.2_1/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c thriftpy2/transport/cybase.c -o build/temp.macosx-11-x86_64-3.9/thriftpy2/transport/cybase.o
  clang: error: invalid version number in 'MACOSX_DEPLOYMENT_TARGET=11'
  error: command '/usr/bin/clang' failed with exit code 1
  ----------------------------------------
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ—¥å¿—é‡Œçš„å…³é”®ä¿¡æ¯ï¼š

```shell
clang: error: invalid version number in 'MACOSX_DEPLOYMENT_TARGET=11'
```

## è§£å†³åŠæ³•

### 1. æ£€æŸ¥å½“å‰ç³»ç»Ÿ clang ç‰ˆæœ¬

```shell
$ clang --version
Apple clang version 11.0.3 (clang-1103.0.32.62)
Target: x86_64-apple-darwin20.3.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin
```

### 2. å†æ¬¡æ£€æŸ¥ç³»ç»ŸCommandLineToolsç‰ˆæœ¬

```shell
$ softwareupdate --all --install --force
Software Update Tool

Finding available software
No updates are available.
```

> è¿™é‡Œå…¶å®æ˜¯ä¸ªå‘ï¼Œé€šè¿‡ `softwareupdate` å…¶å®å‘ç°ä¸äº†ï¼Œæˆ‘ä»¬é€šè¿‡å¦å¤–ä¸€ä¸ªå·¥å…·æ£€æŸ¥ä¸‹

```shell
$ brew doctor
Please note that these warnings are just used to help the Homebrew maintainers
with debugging if you file an issue. If everything you use Homebrew for is
working fine: please don't worry or file an issue; just ignore this. Thanks!
......(çœç•¥éƒ¨åˆ†æ—¥å¿—)
Warning: Your Command Line Tools (CLT) does not support macOS 11.
It is either outdated or was modified.
Please update your Command Line Tools (CLT) or delete it if no updates are available.
Update them from Software Update in System Preferences or run:
  softwareupdate --all --install --force

If that doesn't show you any updates, run:
  sudo rm -rf /Library/Developer/CommandLineTools
  sudo xcode-select --install

Alternatively, manually download them from:
  https://developer.apple.com/download/more/.
```

åç”Ÿä½ å‘ç°äº†ä¸€ä¸ªç›²ç‚¹ï¼æœç„¶ï¼Œ`homebrew` çœŸæ˜¯å¥½ç”¨ï¼:full_moon_with_face:

```shell
Your Command Line Tools (CLT) does not support macOS 11.
```

### 3. é‡æ–°å®‰è£…CommandLineTools

```shell
$ sudo rm -rf /Library/Developer/CommandLineTools
$ sudo xcode-select --install
```

æ ¹æ®ç½‘ç»œç¯å¢ƒï¼Œç­‰å¾…å®‰è£…æˆåŠŸå³å¯~

### 4. å†æ¬¡æ£€æŸ¥ clang ç‰ˆæœ¬

```shell
$ clang --version
Apple clang version 12.0.0 (clang-1200.0.32.29)
Target: x86_64-apple-darwin20.3.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin
```

### 5. é‡æ–°å®‰è£… SDK è¯•è¯•ï¼Ÿ

```shell
$ pip install jqdatasdk
......(çœç•¥éƒ¨åˆ†æ—¥å¿—)
Successfully installed SQLAlchemy-1.3.23 jqdatasdk-1.8.8 msgpack-1.0.2 pandas-1.2.3 pymysql-1.0.2 requests-2.25.1 thriftpy2-0.4.14
```

Enjoy~

## åè®°

æµ‹è¯•ä¸€ä¸‹ï¼Œè¸å‡ºç¬¬ä¸€æ­¥ï¼š

```python
from jqdatasdk import *

auth('xxxxxx', 'xxxxxx')

# æŸ¥è¯¢ è´µå·èŒ…å°[600519.XSHG] è¿‘5å¤©çš„äº¤æ˜“æ•°æ®
df = get_price('600519.XSHG', count=5, end_date='2021-03-10', frequency='daily')
print(df)
```

æ­¤æ—¶å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š

```
æç¤ºï¼šå½“å‰ç¯å¢ƒ pandas ç‰ˆæœ¬é«˜äº 0.25ï¼Œget_price ä¸ get_fundamentals_continuously æ¥å£ panel å‚æ•°å°†å›ºå®šä¸º False
æ³¨æ„ï¼š0.25 ä»¥ä¸Šç‰ˆæœ¬ pandas ä¸æ”¯æŒ panelï¼Œå¦‚ä½¿ç”¨è¯¥æ•°æ®ç»“æ„å’Œç›¸å…³å‡½æ•°è¯·æ³¨æ„ä¿®æ”¹
auth success
               open    close     high      low     volume         money
2021-03-04  2095.00  2033.00  2096.00  2010.10  6508829.0  1.329730e+10
2021-03-05  2000.00  2060.11  2095.00  1988.00  6377920.0  1.310032e+10
2021-03-08  2074.96  1960.00  2085.00  1960.00  6309959.0  1.272425e+10
2021-03-09  1955.00  1936.99  2000.00  1900.18  8226581.0  1.610077e+10
2021-03-10  1977.00  1970.01  1999.87  1967.00  5117174.0  1.013691e+10
```

å¾—åˆ°æ•°æ®çš„åŒæ—¶ï¼Œè®°å¾—å»ä¸“ä¸šçš„è‚¡ç¥¨äº¤æ˜“ç­‰ç½‘ç«™å»æ ¸å¯¹æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®æ˜¯å¦å‡†ç¡®å“¦~

å› ä¸ºè¿™ä¼šç›´æ¥å½±å“åˆ°åé¢é‡åŒ–çš„æŒ‡æ ‡ï¼ï¼

![ä¸ç©äº†,æŠŠé’±è¿˜æˆ‘](https://cdn.xkcoding.com/emoji/20210310.png)

## å‚è€ƒ

https://stackoverflow.com/questions/63972113/big-sur-clang-invalid-version-error-due-to-macosx-deployment-target
