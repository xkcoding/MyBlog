---
title: ç®€å• HTTP å·¥å…·
comments: true
fancybox: false
toc: true
date: 2019-12-26 18:03:23
tags: 
- JustAuth
- å¼€æº
categories:
- å¼€æº
- simple-http
description:
permalink: xkcoding-simple-http
top:
---
## 1. å‰è¨€

å› ä¸ºæœ¬äººæ˜¯ [JustAuth](https://github.com/justauth/JustAuth) çš„ä¸»è¦è´¡çŒ®è€…ä¹‹ä¸€ï¼Œ`JustAuth` é‡Œéœ€è¦å’Œå„å¤§å¹³å°åš HTTP äº¤äº’æ¥æ¢å– Tokenã€ç”¨æˆ·ä¿¡æ¯ç­‰æ•°æ®ï¼Œä½¿ç”¨çš„æ˜¯ `hutool-http`æ¥å®ç° HTTP è¯·æ±‚çš„å‘é€ã€‚å‰æ®µæ—¶é—´ï¼Œæœ‰æœ‹å‹æå‡ºä¸€ä¸ªéœ€æ±‚ï¼šèƒ½å¦ä½¿ç”¨ `OkHttp3` ç­‰æ›´ä¼˜ç§€çš„ HTTP è¯·æ±‚å·¥å…·æ¥æ›¿æ¢é»˜è®¤çš„ `hutool-http` ï¼Ÿäºæ˜¯å†™ä¸€ä¸ª `simple-http` çš„æƒ³æ³•å°±è¯ç”Ÿäº†ã€‚

<!--more-->

## 2. è®¾è®¡æ€è·¯

### 2.1. è§£è€¦

`simple-http` è®¾è®¡å‡ºæ¥å°±æ˜¯ä¸ºäº†è§£å†³ `JustAuth` ä¸­å¯¹ `hutool-http` çš„å¼ºè€¦åˆï¼Œæ‰€ä»¥éœ€è¦å…ˆæ‰¾åˆ° `JustAuth` ä¸­åˆ°åº•ä½¿ç”¨åˆ°äº†éœ€è¦å“ªäº› HTTP è¯·æ±‚ï¼Œæ‰¾åˆ°å®ƒä»¬çš„å…±æ€§ï¼Œæ‰èƒ½è§£è€¦ã€‚å…·ä½“å‚è§ä¸‹è¡¨ï¼š

| è¯·æ±‚ç±»å‹ | è¯·æ±‚å‚æ•°ç±»å‹ | å“åº”æ•°æ®ç±»å‹ |        å…¶ä»–        |
| :------: | :----------: | :----------: | :----------------: |
|   GET    |    query     |  JSONã€TEXT  | Headerã€URL Encode |
|   POST   |  Formã€JSON  |  JSONã€TEXT  | Headerã€URL Encode |

å“åº”çš„æ•°æ®ç±»å‹ï¼Œæœ‰äº›æ˜¯æ ¼å¼åŒ–çš„ JSON æ•°æ®ï¼Œæœ‰äº›åªæ˜¯ç®€å•çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä½†æ€»çš„æ¥è¯´éƒ½æ˜¯å­—ç¬¦ä¸²æ•°æ®ï¼Œå…·ä½“çš„è§£æï¼Œäº¤ç»™ä½¿ç”¨æ–¹å»å¤„ç†ã€‚æ‰€ä»¥ï¼Œæ­¤æ—¶é€šç”¨HTTPçš„æ¥å£å°±å·²ç»å¯ä»¥è®¾è®¡å‡ºæ¥äº†ã€‚

```java
/**
 * <p>
 * HTTP æ¥å£
 * </p>
 *
 * @author yangkai.shen
 * @date Created in 2019/12/24 18:21
 */
public interface Http {
	/**
	 * GET è¯·æ±‚
	 *
	 * @param url URL
	 * @return ç»“æœ
	 */
	String get(String url);

	/**
	 * GET è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params å‚æ•°
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	String get(String url, Map<String, String> params, boolean encode);

	/**
	 * GET è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	String get(String url, Map<String, String> params, HttpHeader header, boolean encode);

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url URL
	 * @return ç»“æœ
	 */
	String post(String url);

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url  URL
	 * @param data JSON å‚æ•°
	 * @return ç»“æœ
	 */
	String post(String url, String data);

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param data   JSON å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @return ç»“æœ
	 */
	String post(String url, String data, HttpHeader header);

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params form å‚æ•°
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	String post(String url, Map<String, String> params, boolean encode);

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params form å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	String post(String url, Map<String, String> params, HttpHeader header, boolean encode);
}
```

### 2.2. é›å½¢

æ—¢ç„¶é€šç”¨æ¥å£å·²ç»è®¾è®¡å‡ºæ¥äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯éœ€è¦é€‰æ‹©å…·ä½“å‘é€ HTTP çš„å·¥å…·åŒ…ã€‚è¿™ä¸€æ­¥æœ‰ 2 ä¸ªè¦æ±‚ï¼Œ**æ—¢éœ€è¦æ ¹æ®å¸¸è§çš„ HTTP å·¥å…·ä¾èµ–æ¥è‡ªåŠ¨å†³å®šï¼Œä¹Ÿéœ€è¦æä¾›ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®çš„ä¾¿æ·æ€§**ã€‚

- æ ¹æ®å¼•å…¥çš„ä¾èµ–åˆ¤æ–­ä½¿ç”¨å“ªä¸€ä¸ª HTTP å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ `Class.forName()` æ¥åˆ¤æ–­
- ç”¨æˆ·è‡ªå®šä¹‰ï¼Œç®€å•çš„è¯´å°±æ˜¯æä¾› `set` æ–¹æ³•

```java
/**
 * <p>
 * è¯·æ±‚å·¥å…·ç±»
 * </p>
 *
 * @author yangkai.shen
 * @date Created in 2019/12/24 18:15
 */
@UtilityClass
public class HttpUtil {
	private static Http proxy;

	static {
		Http defaultProxy = null;
		ClassLoader classLoader = HttpUtil.class.getClassLoader();
		// åŸºäº java 11 HttpClient
		if (ClassUtil.isPresent("java.net.http.HttpClient", classLoader)) {
			defaultProxy = new com.xkcoding.http.support.java11.HttpClientImpl();
		}
		// åŸºäº okhttp3
		else if (ClassUtil.isPresent("okhttp3.OkHttpClient", classLoader)) {
			defaultProxy = new OkHttp3Impl();
		}
		// åŸºäº httpclient
		else if (ClassUtil.isPresent("org.apache.http.impl.client.HttpClients", classLoader)) {
			defaultProxy = new HttpClientImpl();
		}
		// åŸºäº hutool
		else if (ClassUtil.isPresent("cn.hutool.http.HttpRequest", classLoader)) {
			defaultProxy = new HutoolImpl();
		}
		proxy = defaultProxy;
	}

	public void setHttp(Http http) {
		proxy = http;
	}
	
	private void checkHttpNotNull(Http proxy) {
		if (null == proxy) {
			throw new SimpleHttpException("HTTP å®ç°ç±»æœªæŒ‡å®šï¼");
		}
	}

	/**
	 * GET è¯·æ±‚
	 *
	 * @param url URL
	 * @return ç»“æœ
	 */
	public String get(String url) {
		checkHttpNotNull(proxy);
		return proxy.get(url);
	}

	/**
	 * GET è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params å‚æ•°
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	public String get(String url, Map<String, String> params, boolean encode) {
		checkHttpNotNull(proxy);
		return proxy.get(url, params, encode);
	}

	/**
	 * GET è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	public String get(String url, Map<String, String> params, HttpHeader header, boolean encode) {
		checkHttpNotNull(proxy);
		return proxy.get(url, params, header, encode);
	}

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url URL
	 * @return ç»“æœ
	 */
	public String post(String url) {
		checkHttpNotNull(proxy);
		return proxy.post(url);
	}

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url  URL
	 * @param data JSON å‚æ•°
	 * @return ç»“æœ
	 */
	public String post(String url, String data) {
		checkHttpNotNull(proxy);
		return proxy.post(url, data);
	}

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param data   JSON å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @return ç»“æœ
	 */
	public String post(String url, String data, HttpHeader header) {
		checkHttpNotNull(proxy);
		return proxy.post(url, data, header);
	}

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params form å‚æ•°
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	public String post(String url, Map<String, String> params, boolean encode) {
		checkHttpNotNull(proxy);
		return proxy.post(url, params, encode);
	}

	/**
	 * POST è¯·æ±‚
	 *
	 * @param url    URL
	 * @param params form å‚æ•°
	 * @param header è¯·æ±‚å¤´
	 * @param encode æ˜¯å¦éœ€è¦ url encode
	 * @return ç»“æœ
	 */
	public String post(String url, Map<String, String> params, HttpHeader header, boolean encode) {
		checkHttpNotNull(proxy);
		return proxy.post(url, params, header, encode);
	}
}
```

### 2.3. å®ç°

> å¦‚æœçœ‹äº†å‰é¢çš„è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« çš„è¯ï¼Œåº”è¯¥çŸ¥é“ä¸Šé¢å…¶å®å¯ä»¥ç”¨åˆ° 3 ç§è®¾è®¡æ¨¡å¼ï¼š`ä»£ç†æ¨¡å¼ã€å§”æ´¾æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼`ï¼Œæ²¡çœ‹å‡ºæ¥çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å»å­¦ä¹ å­¦ä¹ å“¦~ [è®¾è®¡æ¨¡å¼ä¼ é€é—¨ğŸ‘‰](https://xkcoding.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/)

`simple-http` æä¾›äº† 4 ç§é»˜è®¤å®ç°ï¼Œåˆ†åˆ«æ˜¯ `JDK11 çš„ HttpClient`ã€`OkHttp3`ã€`Apache çš„ HttpClient`ã€`hutool-http`ï¼Œå¦‚æœé¡¹ç›®ä¸­åŒæ—¶å­˜åœ¨è¿™å‡ ä¸ª HTTP å·¥å…·çš„ä¾èµ–ï¼Œé‚£ä¹ˆ `simple-http` ä¼šæ ¹æ®ä¼˜å…ˆçº§é¡ºåºä»å·¦å¾€å³ï¼Œè‡ªè¡Œé€‰æ‹©å…·ä½“æ‰§è¡Œ HTTP è¯·æ±‚çš„å·¥å…·ã€‚æºç æ¯”è¾ƒå¤šï¼Œå°±ä¸è´´åœ¨åšå®¢é‡Œäº†ï¼Œå…³äºè¿™ 4 ç§é»˜è®¤å®ç°çš„è¯¦ç»†ä»£ç ï¼Œè¯·è‡ªè¡Œå‰å¾€ GitHub é˜…è¯»æºç å®ç°ï¼Œ[æºç ä¼ é€é—¨ğŸ‘‰](https://github.com/xkcoding/simple-http)ã€‚

## 3. ä½¿ç”¨æ–¹å¼

å¼•å…¥ `simple-http` ä¾èµ–

```xml
<dependency>
  <groupId>com.xkcoding.http</groupId>
  <artifactId>simple-http</artifactId>
  <version>1.0</version>
</dependency>
```

å†å¼•ç”¨å…·ä½“å®ç°

- JDK11 çš„ HttpClientï¼ˆä½¿ç”¨ JDK11 å³å¯ï¼‰
- OkHttp3

```xml
<dependency>
  <groupId>com.squareup.okhttp3</groupId>
  <artifactId>okhttp</artifactId>
  <version>${okhttp3.version}</version>
</dependency>
```

- Apache HttpClient

```xml
<dependency>
  <groupId>org.apache.httpcomponents</groupId>
  <artifactId>httpclient</artifactId>
  <version>${httpclient.version}</version>
</dependency>
```

- Hutool çš„ HTTP

```xml
<dependency>
  <groupId>cn.hutool</groupId>
  <artifactId>hutool-http</artifactId>
  <version>${hutool.version}</version>
</dependency>
```

- å¦‚æœä¸æƒ³ä½¿ç”¨é»˜è®¤çš„ï¼Œå¯ä»¥è‡ªå®šå®ç° `com.xkcoding.http.support.Http` æ¥å£ï¼Œç„¶åé€šè¿‡ `com.xkcoding.http.HttpUtil#setHttp(Http http)` é…ç½®

ç„¶åå°±å¯ä»¥ä½¿ç”¨ `HttpUtil.xxx` å¼€å¿ƒçš„è€èµ·æ¥äº†~

## 4. ä¸è¶³ä¸æ”¹è¿›

1. ç›®å‰ `simple-http` ä»…æ”¯æŒ `GETã€POST` æ–¹å¼ï¼Œå…¶ä½™æ–¹å¼ï¼Œæœªæ¥æœ‰æœºä¼šçš„è¯ï¼Œä¼šè€ƒè™‘æ‰©å±•ï¼Œç›®å‰å¯¹ `JustAuth` æ¥è¯´ï¼Œå·²ç»å¤Ÿç”¨å•¦~
2. ç›®å‰è¿”å›å€¼éƒ½æ˜¯ `String`ï¼Œåç»­è¦ä¸è¦åŠ ä¸€ä¸ªè‡ªåŠ¨è§£æè¿”å›ç±»å‹çš„æ¥å£ï¼Ÿå¦‚æœå“åº”æ˜¯ JSON å†…å®¹çš„ï¼Œ å°±é»˜è®¤è¿”å› JSONï¼Œå¦‚æœæ˜¯ html ç»“æ„çš„ï¼Œå°±é»˜è®¤è¿”å› Document ç­‰ç­‰ã€‚å“å‘€å‘€ï¼Œå†è¯´å§ï¼Œå†è¯´å§~

## 5. å…¶ä»–

- `simple-http` é¢„è®¡ä¼šåœ¨ `JustAuth` çš„ `1.4.x` ç‰ˆæœ¬æ­£å¼ä¸Šçº¿ï¼Œç›®å‰æ•´åˆå·²å®Œæ¯•(2019.12.25)ï¼Œå·²æäº¤ [PR](https://github.com/justauth/JustAuth/pull/59)ï¼Œå¾…å°ç»„æˆå‘˜ä»”ç»†æµ‹è¯•ä¹‹åå°±ä¼šå‘å¸ƒã€‚å±Šæ—¶æ¬¢è¿å°ä¼™ä¼´ä»¬å°è¯•~
- `simple-http` çš„çµæ„Ÿæ¥è‡ª [@æ˜¥å“¥](https://github.com/ChunMengLu) çš„ jfinal-weixin çš„ [HttpUtils](https://gitee.com/jfinal/jfinal-weixin/blob/master/src/main/java/com/jfinal/weixin/sdk/utils/HttpUtils.java)ã€‚
- JDK 11 çš„ `HttpClient` å®ç°ï¼Œæœ¬äººèœçš„ä¸€é€¼ï¼Œæ‰€ä»¥ä¸»è¦ä¹Ÿæ˜¯ [@æ˜¥å“¥](https://github.com/ChunMengLu) çš„è´¡çŒ®ï¼Œè†œæ‹œå°±å®Œäº‹äº†~